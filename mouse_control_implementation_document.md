# 鼠标控制功能实现文档

## 1. 功能需求

当用户点击集成软件中鼠标控制区域的"开始"按钮后，系统需要接管鼠标的运行控制，进行特定的自动操作，以便实现智能监控功能。

注意：所有提及的课程均默认为经过筛选的今日课程内容。

## 1.1 用户中断机制

当系统接管鼠标控制后，用户可以通过手动点击空格键随时中断鼠标控制行为，确保在紧急情况下能够立即恢复对鼠标的控制。

### 1.1.1 中断触发方式
- 用户手动点击键盘上的空格键
- 系统应实时监听键盘事件，优先响应空格键中断请求

### 1.1.2 中断后的处理
- 立即停止所有正在执行的鼠标控制行为
- 释放对鼠标的控制权限，交还给用户
- 在日志中记录中断事件，包括中断时间和当前执行的行为
- 保持软件其他功能正常运行，允许用户重新点击"开始"按钮恢复鼠标控制

## 2. 鼠标控制逻辑模块数据调用功能

开发一个鼠标控制逻辑模块，该模块需要实现以下数据调用功能：
 1. 调用系统时间接口获取当前日期和时间信息
 2. 查询今日课程信息，包括课程名称、开始时间和结束时间
 3. 调用屏幕检测功能获取当前显示的界面信息
 4. 调用获取保存在/img路径下的图片资源，包括课程名称图标和按钮图标

注意：上述功能调用无固定执行顺序，仅为需要实现的数据调用列表。部分数据可能已在集成软件中完成调用，请先检查系统中已调用的数据项，避免重复调用。

## 2.1 日志记录功能

系统需要实现全面的日志记录功能，记录所有系统判断和鼠标操作行为，确保日志内容清晰易懂，便于用户监控和调试。

### 2.1.1 日志记录内容
- **系统时间信息**：每次日志记录时的精确时间戳（格式：YYYY-MM-DD HH:MM:SS）
- **行为模式切换**：记录系统在不同行为模式（课程开始前、课程进行中、课程切换）之间的切换
- **条件判断结果**：记录系统对各种触发条件的判断结果（如时间判断、屏幕检测结果）
- **图片识别信息**：记录调用的图片资源路径、匹配相似度、识别到的屏幕位置坐标
- **鼠标操作记录**：记录鼠标移动的起始位置、目标位置、点击操作的执行结果
- **用户交互事件**：记录用户的开始、中断等操作
- **错误和异常**：记录系统运行过程中遇到的任何错误或异常情况

### 2.1.2 日志格式规范
- 采用结构化的日志格式，使用清晰的分隔符和标签
- 每条日志记录前添加明确的时间戳
- 使用易读的中文描述，避免使用专业术语或简写
- 关键操作和重要信息使用醒目标识（如"[重要]"、"[操作]"、"[判断]"等）

### 2.1.3 日志存储和查看
- 日志文件应保存在项目根目录下的logs文件夹中
- 日志文件命名格式：mouse_control_log_YYYY-MM-DD.log（按日期生成新文件）
- 提供简单的日志查看界面，允许用户实时查看和搜索日志内容
- 支持日志导出功能，方便用户进行离线分析

## 3. 鼠标控制的主要行为模式

### 3.1 课程开始前行为

当系统检测到当前时间点为课程开始时间之前，且该时间点之前没有正在进行或已结束的课程时，需要控制鼠标执行一系列操作以进入指定的课程界面。

#### 3.1.1 触发条件
- 屏幕检测结果必须明确识别为"Course Menu"界面
- 必须符合预设的课程开始行为时间点
- 当前时间在课程开始时间之前

#### 3.1.2 课程图片调用与定位
- 系统需要调用即将开始的课程对应的图片资源
- 该图片已以课程名称命名并存储于/img/course路径下
- 系统需通过图像识别技术在屏幕中查找与该图片最高相似度的区域（考虑到可能存在多个相似区域）

#### 3.1.3 鼠标操作执行
- 软件需模拟鼠标控制行为，自动将光标移动至识别出的最高相似度区域
- 执行精准点击操作以启动课程

### 3.2 课程进行中行为（在课程开始到结束时间之间执行）

#### 3.2.1 进入答题行为

当屏幕检测为Course Starts时，需要执行进入答题行为。

##### 3.2.1.1 触发条件
- 屏幕检测结果必须明确识别为"Course Starts"界面
- 当前时间在课程进行时间内（课程开始时间到结束时间之间）

##### 3.2.1.2 图片调用与定位
- 调用/img/course_starts路径下的join.PNG图片
- 系统需通过图像识别技术在屏幕中查找与该图片匹配的区域

##### 3.2.1.3 鼠标操作执行
- 控制鼠标移动到屏幕中与该图片符合的区域
- 执行点击操作以进入答题

#### 3.2.2 答题行为

当屏幕检测为Poll Starts时，需要执行答题行为。

##### 3.2.2.1 触发条件
- 屏幕检测结果必须明确识别为"Poll Starts"界面
- 当前时间在课程进行时间内（课程开始时间到结束时间之间）

##### 3.2.2.2 图片调用与定位
- 调用/img/click路径下的a.PNG图片
- 系统需通过图像识别技术在屏幕中查找与该图片匹配的区域

##### 3.2.2.3 鼠标操作执行
- 控制鼠标移动到屏幕中与该图片符合的区域
- 执行点击操作以完成答题

##### 3.2.2.4 重复执行机制
- 答题行为可能需要在课程进行时间内多次重复运行
- 当执行答题行为的鼠标点击后，屏幕检测状态可能会切换为其他界面
- 当屏幕检测状态再次变为"Poll Starts"时，表示出现了一道新的题目
- 此时系统需要重新执行答题行为的完整流程（从触发条件开始）以完成新题目的答题操作

### 3.3 课程切换行为（过渡时段执行）

当系统检测到当前时间点处于前一节课结束之后且下一节课开始之前的过渡时段时，需要控制鼠标执行退出当前课程界面并返回到课程栏界面的操作，为进入下一节课做好准备。

#### 3.3.1 执行过程限制

在执行课程切换行为的过程中：
- 只会执行属于课程切换行为的退出行为（3.3.2）和返回行为（3.3.3）
- 尽管屏幕检测可能会检测并满足其他行为的条件，但都不予执行
- 系统会忽略所有非课程切换行为的操作请求

#### 3.3.2 退出行为

当屏幕检测为Leave Session时，执行退出行为：

##### 3.3.2.1 触发条件
- 屏幕检测结果必须明确识别为"Leave Session"界面
- 必须发生在课程切换行为的时间段中（前一节课结束之后且下一节课开始之前）

##### 3.3.2.2 图片调用与定位
- 调用/img/click/leave.PNG图片
- 系统需通过图像识别技术在屏幕中查找与该图片高相似的区域

##### 3.3.2.3 鼠标操作执行
- 控制鼠标移动到屏幕中与该图片高相似的区域
- 执行点击操作以退出当前会话

##### 3.3.2.4 优先级说明
- 退出行为的优先级大于返回行为
- 如果屏幕上同时存在退出行为和返回行为对应的图片，优先执行退出行为

#### 3.3.3 返回行为

不论当前界面是什么，执行返回行为：

##### 3.3.3.1 触发条件
- 只有在当前时间符合课程切换行为的时间段时才会执行返回行为
- 当前时间必须处于课程结束后的过渡时段（前一节课结束之后且下一节课开始之前）
- 如果屏幕上没有退出行为对应的图片，才执行返回行为

##### 3.3.3.2 图片调用与定位
- 调用/img/click/return.PNG图片
- 系统需通过图像识别技术在屏幕中查找与该图片相似的区域
- 如果屏幕上有多个类似的相似区域，选择屏幕位置上最左侧的那一个

##### 3.3.3.3 鼠标操作执行
- 控制鼠标移动到选定的相似区域
- 执行点击操作以返回上一级界面

#### 3.3.4 完成条件与后续操作

- 如果在课程切换行为的过程中，屏幕检测变为"Course Menu"，说明已经退回到了主菜单
- 此时课程切换行为视为已完成
- 课程切换行为完成后，系统会检查是否还有后续课程：
  - 如果接下来还有课程，应立即执行课程开始前行为（3.1）的所有条件判断、触发判定和鼠标操作执行，以进入下一节课
  - 如果当天没有更多课程，则保持在"Course Menu"界面
- 注意：一旦进入到下一节课的课程进行时间，所有课程进行中行为（3.2）在满足相应触发条件后都应立即执行，包括进入答题行为（3.2.1）和答题行为（3.2.2）

### 3.4 行为模式切换机制

行为模式的切换机制应基于当前系统时间与预设课程时间表的对比结果来实现：
1. 课程开始前：执行课程开始前行为（3.1）
2. 课程进行中：执行课程进行中行为（3.2），包括进入答题行为（3.2.1）和答题行为（3.2.2）
3. 课程结束后过渡时段：执行课程切换行为（3.3）

需要明确时间判断的具体逻辑和阈值条件，确保各行为模式能够根据实际课程时间安排准确切换。